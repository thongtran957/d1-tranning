<!doctype html>
<html lang="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Add datatables library -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css">
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
    <!-- Add data.json -->
    <script type="application/json" src="data.json"></script>
</head>
<body>
<div id="container">
    <h1>Danh sách sinh viên</h1>
    <button type="button" class="btn btn-primary" onclick="show_modal()">Tạo mới</button>
    <div id="msg"></div>
    <div>
        <table id="dtBasicExample" class="table table-bordered table-striped" cellspacing="0" width="100%">
            <thead>
            <tr>
                <th>
                    <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="checkout">
                        <label class="custom-control-label"></label>
                    </div>
                </th>
                <th>Mã SV</th>
                <th>Họ Tên</th>
                <th>Ngày Sinh</th>
                <th>Giới Tính</th>
                <th>Địa chỉ</th>
                <th>Số điện thoại</th>
                <th>Khoa</th>
                <th>Chuyên Ngành</th>
                <th>Sửa</th>
                <th>Xóa</th>
            </tr>
            </thead>
            <tbody id="content">
            </tbody>
        </table>
    </div>
    <button type="button" class="btn btn-primary">Xóa</button>
    <div id="test">
        <div class="row d-flex justify-content-center modalWrapper">
            <div class="modal fade addNewInputs" id="modalAdd" tabindex="-1" role="dialog" aria-labelledby="modalAdd"
                 aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header text-center">
                            <h4 class="modal-title w-100 font-weight-bold ml-5">Tạo mới sinh viên</h4>
                            <button type="button" class="close text-primary" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body mx-3">
                            <form id="formAdd" name="formAdd">
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">Mã sinh viên *</label>
                                    <div class="col-sm-9">
                                        <input id="id"
                                               type="text"
                                               class="form-control"
                                               name="id"
                                               required>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">Họ tên *</label>
                                    <div class="col-sm-9">
                                        <input id="name"
                                               type="text"
                                               class="form-control"
                                               name="name"
                                               required>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">Giới tính *</label>
                                    <div class="col-sm-9">
                                        <select class="form-control" id="gender" name="gender" required>
                                            <option>Nam</option>
                                            <option>Nữ</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">Ngày sinh *</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="date"
                                               id="birthday"
                                               value="2019-06-10"
                                               required
                                               name="birthday">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">Địa chỉ </label>
                                    <div class="col-sm-9">
                                        <input id="address"
                                               type="text"
                                               class="form-control"
                                               name="address">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">Số điện thoại *</label>
                                    <div class="col-sm-9">
                                        <input id="phone_number"
                                               type="text"
                                               class="form-control"
                                               name="phone_number">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">Khoa *</label>
                                    <div class="col-sm-9">
                                        <select class="form-control" id="faculty" name="faculty" required>

                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-3 col-form-label">Chuyên Ngành *</label>
                                    <div class="col-sm-9">
                                        <select class="form-control" id="major" name="major" required>
                                        </select>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" id="btn-create">Thêm</button>
                                    <button type="button" class="btn btn-danger" data-dismiss="modal">Hủy</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    var faculty_data = [
        {
            "id": 1,
            "name": "CNTT",
        },
        {
            "id": 2,
            "name": "QTKD",
        },
    ]

    var major_data = [
        {
            'id': 1,
            'name': 'phan mem',
            'faculty_id': 1
        },
        {
            'id': 2,
            'name': 'phan cung',
            'faculty_id': 1
        },
        {
            'id': 3,
            'name': 'QTKD1',
            'faculty_id': 2
        },
        {
            'id': 4,
            'name': 'QTKD2',
            'faculty_id': 2
        },
        {
            'id': 5,
            'name': 'QTKD3',
            'faculty_id': 2
        }
    ]
    //getdata from file json and load data to screen
    var my_data
    $.getJSON("data.json", function (data) {
        my_data = data
        content = ''
        data.forEach(function (obj) {
            var row_content =
                '<tr>\n' +
                '<th scope="row">\n' +
                '<div class="custom-control custom-checkbox">\n' +
                '<input type="checkbox" class="custom-control-input">\n' +
                '<label class="custom-control-label"></label>\n' +
                '</div>\n' +
                '</th>\n' +
                '<th>' + obj.id + '</th>\n' +
                '<th>' + obj.name + '</th>\n' +
                '<th>' + obj.birthday + '</th>\n' +
                '<th>' + obj.gender + '</th>\n' +
                '<th>' + obj.address + '</th>\n' +
                '<th>' + obj.phone_number + '</th>\n' +
                '<th>' + obj.faculty + '</th>\n' +
                '<th>' + obj.major + '</th>\n' +
                '<th>\n' +
                '<button class="btn btn-outline-primary"><i class="fa fa-pencil"></i></button>\n' +
                '</th>\n' +
                '<th>\n' +
                '<button class="btn btn-outline-primary"><i class="fa fa-trash"></i></button>\n' +
                '</th>\n' +
                '</tr>\n'
            content += row_content
        })
        document.getElementById("content").innerHTML = content
    });

    function show_modal() {
        $('#modalAdd').modal();
    }

    //dependent box faculty and major
    var faculty_content = ""
    faculty_data.forEach(function (data) {
        faculty_content += '<option value="' + data.id + '">' + data.name + '</option>'
    })
    document.getElementById("faculty").innerHTML = faculty_content

    var major_content = ""
    major_data.forEach(function (data) {
        major_content += '<option value="' + data.faculty_id + '">' + data.name + '</option>'
    })
    document.getElementById("major").innerHTML = major_content

    var faculty = $("#faculty")
    var major = $("#major")
    $options = major.find('option')

    faculty.on('change', function () {
        major.html($options.filter('[value="' + this.value + '"]'))
    }).trigger('change')

    $('#btn-create').click(function (e) {
        //get data from form and format
        var formInputs = $('#formAdd').serializeArray()
        var obj = {}
        formInputs.forEach(function (data) {
            switch (data.name) {
                case 'id':
                    obj.id = data.value
                    break;
                case 'name':
                    obj.name = data.value
                    break;
                case 'birthday':
                    obj.birthday = data.value
                    break;
                case 'gender':
                    obj.gender = data.value
                    break;
                case 'address':
                    obj.address = data.value
                    break;
                case 'phone_number':
                    obj.phone_number = data.value
                    break;
                case 'faculty':
                    data.value = $("#faculty option:selected").text()
                    obj.faculty = data.value
                    break;
                case 'major':
                    data.value = $("#major option:selected").text()
                    obj.major = data.value
                    break;
                default:
            }
        })
        //validate duplicate id
        check = true
        my_data.forEach(function (ele) {
            if (obj.id == ele.id) {
                check = false
                $('#modalAdd').modal('hide')
                document.getElementById("msg").innerHTML = '<label>Trùng mã số sinh viên!</label>'
            }
        })

        if (check == true) {
            my_data.push(obj)
            content = ''
            my_data.forEach(function (obj) {
                var row_content =
                    '<tr>\n' +
                    '<th scope="row">\n' +
                    '<div class="custom-control custom-checkbox">\n' +
                    '<input type="checkbox" class="custom-control-input">\n' +
                    '<label class="custom-control-label"></label>\n' +
                    '</div>\n' +
                    '</th>\n' +
                    '<th>' + obj.id + '</th>\n' +
                    '<th>' + obj.name + '</th>\n' +
                    '<th>' + obj.birthday + '</th>\n' +
                    '<th>' + obj.gender + '</th>\n' +
                    '<th>' + obj.address + '</th>\n' +
                    '<th>' + obj.phone_number + '</th>\n' +
                    '<th>' + obj.faculty + '</th>\n' +
                    '<th>' + obj.major + '</th>\n' +
                    '<th>\n' +
                    '<button class="btn btn-outline-primary"><i class="fa fa-pencil"></i></button>\n' +
                    '</th>\n' +
                    '<th>\n' +
                    '<button class="btn btn-outline-primary"><i class="fa fa-trash"></i></button>\n' +
                    '</th>\n' +
                    '</tr>\n'
                content += row_content
            })
            document.getElementById("content").innerHTML = content
        }
        console.log(my_data)
    })

</script>
</html>